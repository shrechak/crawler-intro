(function(b){var d=b.util,f;if(_weq["webengage.licenseCode"]){var c="//c.webengage.com/c.jpg?v=1.0",a=(location.host.match(/[-\w]+(\.(?:[-\w]+\.xn--[-\w]+|[-\w]{3,}|[-\w]+\.[-\w]{2}))?$/i))[0],e={setGoalsCookie:function(h){var g=h||{};var i=d.stringify(g);if(i){d.setCookie("_we_wk_gls_ss_",i,"","/","."+a,"",true)}return g},getGoalsCookie:function(){var g=null,i=d.getCookie("_we_wk_gls_ss_",true);if(i){try{g=(new Function("return "+i)())}catch(h){}}return g},getAllTakenEIdsToTrack:function(j,h){var i=null,k=("notification"===h?"cnids":("survey"===h?"tsids":null));if(k){var g=e.getGoalsCookie();if(g&&g[j]&&g[j][k] instanceof Array&&g[j][k].length>0){i=g[j][k]}}return i},getAllSeenEIdsToTrack:function(j,i){var h=null,k="notification"===i?"snids":("survey"===i?"ssids":null);if(k){var g=e.getGoalsCookie();if(g&&g[j]&&g[j][k] instanceof Array&&g[j][k].length>0){h=g[j][k]}}return h},getCTANIdsToTrack:function(i){var h=null,g=e.getGoalsCookie();if(g&&g[i]&&g[i]["canids"] instanceof Array&&g[i]["canids"].length>0){h=g[i]["canids"]}return h},logConversion:function(h,g){if(h){b.withELog(function(){var j="",r=d.getWebengageCookie(),t=d.getSessionCookie(),n=e.getGoalsCookie();var p=new Date();var o={gId:h};if(n&&n[h]){var l=((n[h]["snids"] instanceof Array&&n[h]["snids"].length>0)?n[h]["snids"]:null),i=((n[h]["cnids"] instanceof Array&&n[h]["cnids"].length>0)?n[h]["cnids"]:null),q=((n[h]["canids"] instanceof Array&&n[h]["canids"].length>0)?n[h]["canids"]:null),w=((n[h]["ssids"] instanceof Array&&n[h]["ssids"].length>0)?n[h]["ssids"]:null),s=((n[h]["tsids"] instanceof Array&&n[h]["tsids"].length>0)?n[h]["tsids"]:null),m=(typeof n[h]["isUIn"]==="boolean"&&n[h]["isUIn"]?true:false)}if(l&&l.length>0){o.snids=l}if(i&&i.length>0){o.cnids=i}if(w&&w.length>0){o.ssids=w}if(s&&s.length>0){o.tsids=s}if(q&&q.length>0){o.ncnids=q}if(typeof m!=="undefined"){o.isUIn=m}if((_weq["webengage.customData"]&&!b.util.isEmptyObject(_weq["webengage.customData"]))||(_weq["webengage.notification.customData"]&&!b.util.isEmptyObject(_weq["webengage.notification.customData"]))||(_weq["webengage.survey.customData"]&&!b.util.isEmptyObject(_weq["webengage.survey.customData"]))){var v=_weq["webengage.customData"]||{};d.copy(v,(_weq["webengage.survey.customData"]||{}),true);d.copy(v,(_weq["webengage.notification.customData"]||{}),true);o.customData=v}if(g&&!b.util.isEmptyObject(g)){o.customData=o.cd||{};d.copy(o.customData,g,true)}if(!d.isEmptyObject(o.customData)){var x=o.customData;o.customData={};for(var u in x){if(x[u]&&x[u].constructor==Date){o.customDataDate=o.customDataDate||{};o.customDataDate[u]=x[u];continue}o.customData[u]=x[u]}}var k=_weq["webengage.ruleData"]||_weq["webengage.goals.ruleData"]||{};if(!d.isEmptyObject(k)){o.ruleData={};for(var u in k){if(k[u]&&k[u].constructor==Date){o.ruleDataDate=o.ruleDataDate||{};o.ruleDataDate[u]=k[u];continue}o.ruleData[u]=k[u]}}b.dump("goal","accomplish",o);if(n&&n[h]){n[h]["snids"]=null;n[h]["cnids"]=null;n[h]["canids"]=null;n[h]["ssids"]=null;n[h]["tsids"]=null;n[h]["isUIn"]=true;e.setGoalsCookie(n)}},null,true)}}};b.withELog(function(){_weq["webengage.conversion.start"]=function(g){f=g||{};b.withELog(function(){if(f&&f.goals&&f.goals instanceof Array&&f.goals.length>0){_weq["webengage.enableCallbacks"]=true;d.extend("goals",(function(){return{push:function(t,s){if(t){for(var q=0;q<f.goals.length;q++){var r=f.goals[q];if(r.id&&r.id===t){e.logConversion(t,s)}}}}}})());function o(q){var s=["run","open","click"],t=q.id;for(var r=0;r<s.length;r++){b.notification.attachEventListner(s[r],function(v){if(v.notificationId&&q.nIds.indexOf(v.notificationId)>=0){var i=e.getGoalsCookie(),i=i||{};var u=b.util.getSessionCookie();i[t]=i[t]||{isUIn:false};if("open"===v.event){if(typeof v.isClickable==="boolean"&&v.isClickable){i[t]["canids"]=i[t]["canids"]||[];if(i[t]["canids"].indexOf(v.notificationId)<0){i[t]["canids"].push(v.notificationId)}}else{i[t]["snids"]=i[t]["snids"]||[];if(i[t]["snids"].indexOf(v.notificationId)<0){i[t]["snids"].push(v.notificationId)}}e.setGoalsCookie(i)}else{if("click"===v.event){i[t]["cnids"]=i[t]["cnids"]||[];if(i[t]["cnids"].indexOf(v.notificationId)<0){i[t]["cnids"].push(v.notificationId)}e.setGoalsCookie(i)}}}})}}function k(q){var s=["open","submit","complete"];for(var r=0;r<s.length;r++){b.survey.attachEventListner(s[r],function(u){if(u.surveyId&&q.sIds.indexOf(u.surveyId)>=0){var i=e.getGoalsCookie(),i=i||{isUIn:false};var t=b.util.getSessionCookie();i[q.id]=i[q.id]||{};if("open"===u.event){i[goalId]["ssids"]=i[goalId]["ssids"]||[];if(i[goalId]["ssids"].indexOf(u.surveyId)<0){i[goalId]["ssids"].push(u.ssids)}e.setGoalsCookie(i)}else{if("submit"===u.event||"complete"===u.event){i[goalId]["tsids"]=i[goalId]["tsids"]||[];if(i[goalId]["tsids"].indexOf(u.surveyId)<0){i[goalId]["tsids"].push(u.surveyId)}e.setGoalsCookie(i);if(q.type&&q.type==="SURVEY_COMPLETION"&&"complete"===u.event){e.logConversion(q.id)}}}}})}}for(var m=0;m<f.goals.length;m++){var l=f.goals[m],p=l.value,n=l.type;if(!n||n==="WEB_RULE"){var j=_weq["webengage.ruleData"]||_weq["webengage.goals.ruleData"]||{};var h=b.ruleExecutor.execute("",p,j);if(h){e.logConversion(l.id)}}if(l.nIds&&l.nIds instanceof Array&&l.nIds.length>0){o(l)}if(l.sIds&&l.sIds instanceof Array&&l.sIds.length>0){k(l)}}}},null,true)}},null,true)}})(webengage);